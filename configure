#!/usr/bin/env ruby

require 'erb'

LOCALE = ENV['DOTFILES_LOCALE']
RECOGNIZED_LOCALES = ['home', 'work']

raise "Unrecognized locale #{LOCALE}" unless RECOGNIZED_LOCALES.include? LOCALE

renderer = ERB.new(File.read ".vimrc.erb")
clang_library_path = (LOCALE == "home") ? "/Users/lawrence/build/Release+Asserts/lib" : "/Developer/usr/clang-ide/lib"
clang_user_options = (LOCALE == "home") ? "-fblocks -nostdinc -nobuiltininc -I/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator5.0.sdk/usr/include -F/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator5.0.sdk/System/Library/Frameworks -I/usr/lib/clang/3.0/include" : "-fblocks -nostdinc -nobuiltininc -I/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator4.3.sdk/usr/include -F/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator4.3.sdk/System/Library/Frameworks -I/usr/lib/clang/2.0/include -D__IPHONE_OS_VERSION_MIN_REQUIRED=040100 -F/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator4.3.sdk/Developer/Library/Frameworks"

result = renderer.result(binding) 

outpath = File.join(Dir.pwd, '.vimrc')
File.open(outpath, 'w') do |f|
  f << result 
  puts "Created #{outpath} for locale #{LOCALE}"
end
